<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialAI Pro | AI-Powered Social Media Content Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --ai-purple: #7209b7;
            --dark: #1d3557;
            --light: #f8f9fa;
            --gradient: linear-gradient(135deg, #4361ee, #3a0ca3);
            --ai-gradient: linear-gradient(135deg, #7209b7, #4361ee);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .app-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 2rem auto;
            max-width: 1400px;
        }
        
        .navbar-brand {
            font-weight: 800;
            font-size: 1.8rem;
            background: var(--ai-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero-section {
            background: var(--ai-gradient);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .tool-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            border: none;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .ai-badge {
            background: var(--ai-gradient);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .platform-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .twitter-bg { background: #1DA1F2; }
        .instagram-bg { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
        .facebook-bg { background: #4267B2; }
        .linkedin-bg { background: #0077B5; }
        .tiktok-bg { background: #000000; }
        
        .content-output {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
        }
        
        .hashtag-pill {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .hashtag-pill:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        .copy-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 10px;
            padding: 8px 15px;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .ai-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .platform-selector {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .platform-selector.active {
            border-color: var(--ai-purple);
            transform: scale(1.05);
        }
        
        .trending-topic {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .trending-topic:hover {
            transform: translateX(10px);
        }
        
        .performance-metric {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1055;
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container"></div>

    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-robot me-2"></i>SocialAI Pro
                </a>
                <div class="d-flex align-items-center">
                    <span id="userWelcome" class="me-3" style="display: none;">Welcome!</span>
                    <button class="btn btn-outline-primary me-2" onclick="showSection('dashboard')">
                        <i class="fas fa-home me-1"></i> Dashboard
                    </button>
                    <button class="btn btn-primary me-2" onclick="showSection('generator')">
                        <i class="fas fa-magic me-1"></i> AI Generator
                    </button>
                    <div id="authSection">
                        <button class="btn btn-outline-primary" onclick="showAuthModal()">
                            <i class="fas fa-sign-in-alt me-1"></i> Login
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <h1 class="display-4 fw-bold mb-4">AI-Powered Social Media Content Generator</h1>
                <p class="lead mb-4">Create viral content with real AI, optimize hashtags, and boost engagement</p>
                <div class="row">
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <h3 class="mb-0" id="totalGenerations">0</h3>
                            <small>Content Pieces Generated</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <h3 class="mb-0" id="avgEngagement">0%</h3>
                            <small>Avg Engagement Rate</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <h3 class="mb-0" id="topPlatform">-</h3>
                            <small>Top Performing Platform</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <h3 class="mb-0" id="savedTime">0</h3>
                            <small>Hours Saved</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="container-fluid p-4">
            <!-- Dashboard Section -->
            <section id="dashboardSection">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="tool-card p-4">
                            <h3 class="mb-4"><i class="fas fa-chart-line me-2"></i>Performance Analytics</h3>
                            <canvas id="analyticsChart" height="100"></canvas>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="tool-card p-4">
                                    <h5><i class="fas fa-fire me-2"></i>Trending Topics</h5>
                                    <div id="trendingTopics">
                                        <div class="text-center p-4">
                                            <div class="ai-loading"></div>
                                            <p class="mt-2">Loading trending topics...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="tool-card p-4">
                                    <h5><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                                    <button class="btn btn-primary w-100 mb-2" onclick="showSection('generator')">
                                        <i class="fas fa-magic me-2"></i>Generate Content
                                    </button>
                                    <button class="btn btn-outline-primary w-100 mb-2" onclick="loadHashtagIdeas()">
                                        <i class="fas fa-hashtag me-2"></i>Hashtag Ideas
                                    </button>
                                    <button class="btn btn-outline-primary w-100" onclick="loadAnalytics()">
                                        <i class="fas fa-chart-bar me-2"></i>Refresh Analytics
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="tool-card p-4">
                            <h5><i class="fas fa-trophy me-2"></i>Recent Generations</h5>
                            <div id="recentGenerations">
                                <div class="text-center p-4">
                                    <div class="ai-loading"></div>
                                    <p class="mt-2">Loading your content...</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tool-card p-4">
                            <h5><i class="fas fa-lightbulb me-2"></i>AI Suggestions</h5>
                            <div id="aiSuggestions">
                                <div class="text-center p-4">
                                    <div class="ai-loading"></div>
                                    <p class="mt-2">Loading AI suggestions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Generator Section -->
            <section id="generatorSection" style="display: none;">
                <div class="row">
                    <!-- Left Panel - Input -->
                    <div class="col-lg-6">
                        <div class="tool-card p-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3><i class="fas fa-magic me-2"></i>AI Content Generator</h3>
                                <span class="ai-badge">REAL AI POWERED</span>
                            </div>

                            <!-- Platform Selection -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">Select Platform</label>
                                <div class="row g-3">
                                    <div class="col-4">
                                        <div class="platform-selector text-center p-3 rounded active" data-platform="twitter" onclick="selectPlatform(this, 'twitter')">
                                            <div class="platform-icon twitter-bg mx-auto mb-2">
                                                <i class="fab fa-twitter"></i>
                                            </div>
                                            <small>Twitter/X</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="platform-selector text-center p-3 rounded" data-platform="instagram" onclick="selectPlatform(this, 'instagram')">
                                            <div class="platform-icon instagram-bg mx-auto mb-2">
                                                <i class="fab fa-instagram"></i>
                                            </div>
                                            <small>Instagram</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="platform-selector text-center p-3 rounded" data-platform="facebook" onclick="selectPlatform(this, 'facebook')">
                                            <div class="platform-icon facebook-bg mx-auto mb-2">
                                                <i class="fab fa-facebook"></i>
                                            </div>
                                            <small>Facebook</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="platform-selector text-center p-3 rounded" data-platform="linkedin" onclick="selectPlatform(this, 'linkedin')">
                                            <div class="platform-icon linkedin-bg mx-auto mb-2">
                                                <i class="fab fa-linkedin"></i>
                                            </div>
                                            <small>LinkedIn</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="platform-selector text-center p-3 rounded" data-platform="tiktok" onclick="selectPlatform(this, 'tiktok')">
                                            <div class="platform-icon tiktok-bg mx-auto mb-2">
                                                <i class="fab fa-tiktok"></i>
                                            </div>
                                            <small>TikTok</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Content Input -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">What do you want to post about?</label>
                                <textarea class="form-control" id="aiPrompt" rows="3" placeholder="Describe your topic, product, or idea..."></textarea>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Tone/Voice</label>
                                    <select class="form-select" id="aiTone">
                                        <option value="professional">Professional</option>
                                        <option value="casual" selected>Casual/Friendly</option>
                                        <option value="funny">Funny/Humorous</option>
                                        <option value="inspirational">Inspirational</option>
                                        <option value="urgent">Urgent</option>
                                        <option value="educational">Educational</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Content Style</label>
                                    <select class="form-select" id="contentStyle">
                                        <option value="post" selected>Social Media Post</option>
                                        <option value="caption">Image Caption</option>
                                        <option value="thread">Thread</option>
                                        <option value="ad">Ad Copy</option>
                                        <option value="story">Story</option>
                                    </select>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-lg w-100" onclick="generateAIContent()" id="generateBtn">
                                <i class="fas fa-bolt me-2"></i>Generate AI Content
                            </button>
                        </div>
                    </div>

                    <!-- Right Panel - Output -->
                    <div class="col-lg-6">
                        <!-- Generated Content -->
                        <div class="tool-card p-4 mb-4">
                            <h4 class="mb-4"><i class="fas fa-file-alt me-2"></i>Generated Content</h4>
                            <div class="content-output" id="generatedContent" style="display: none;">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <span id="contentPlatform" class="badge bg-light text-dark"></span>
                                    <button class="btn copy-btn" onclick="copyToClipboard('contentText')">
                                        <i class="fas fa-copy me-1"></i> Copy Text
                                    </button>
                                </div>
                                <p id="contentText" class="mb-0"></p>
                            </div>
                            <div id="contentPlaceholder" class="text-center p-5 text-muted">
                                <i class="fas fa-robot fa-3x mb-3"></i>
                                <p>Your AI-generated content will appear here</p>
                            </div>
                        </div>

                        <!-- Hashtag Suggestions -->
                        <div class="tool-card p-4">
                            <h4 class="mb-4"><i class="fas fa-hashtag me-2"></i>Optimized Hashtags</h4>
                            <div id="hashtagSection" style="display: none;">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="fw-bold">AI-Optimized Hashtags</span>
                                        <button class="btn btn-sm copy-btn" onclick="copyToClipboard('hashtagContainer')">
                                            <i class="fas fa-copy me-1"></i> Copy All
                                        </button>
                                    </div>
                                    <div id="hashtagContainer" class="mb-3"></div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="performance-metric">
                                            <small class="text-muted">Estimated Reach</small>
                                            <h5 class="mb-0" id="estimatedReach">0</h5>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="performance-metric">
                                            <small class="text-muted">Engagement Score</small>
                                            <h5 class="mb-0" id="engagementScore">0%</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="hashtagPlaceholder" class="text-center p-4 text-muted">
                                <i class="fas fa-tags fa-2x mb-2"></i>
                                <p>AI-optimized hashtags will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Login to SocialAI Pro</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
                    </div>
                    <button class="btn btn-primary w-100 mb-3" onclick="login()">Login</button>
                    <div class="text-center">
                        <small class="text-muted">Don't have an account? We'll create one for you automatically.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/+esm'

        // Supabase Configuration - REPLACE WITH YOUR ACTUAL CREDENTIALS
        const SUPABASE_URL = 'https://jofkuzaqkvteslwcewoe.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvZmt1emFxa3Z0ZXNsd2Nld29lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MDk2NjYsImV4cCI6MjA3ODI4NTY2Nn0.a6sGYf1qUuWwNdY0xhQi9gtFCJJUlMDRgg9mllV0-_c';
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
                
        // Global Variables
        let currentUser = null;
        let selectedPlatform = 'twitter';
        let analyticsChart = null;

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // Check for existing session
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                updateUIForLoggedInUser();
                loadDashboardData();
            } else {
                showAuthModal();
            }

            // Initialize analytics chart
            initializeAnalyticsChart();
        }

        function initializeAnalyticsChart() {
            const ctx = document.getElementById('analyticsChart').getContext('2d');
            analyticsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Content Performance',
                        data: [],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Authentication Functions
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showToast('Please enter both email and password', 'error');
                return;
            }

            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password
            });

            if (error) {
                // Try to sign up if user doesn't exist
                const { data: signupData, error: signupError } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (signupError) {
                    showToast('Authentication failed: ' + signupError.message, 'error');
                    return;
                }

                showToast('Account created successfully! Please check your email for verification.', 'success');
                currentUser = signupData.user;
            } else {
                currentUser = data.user;
                showToast('Login successful!', 'success');
            }

            updateUIForLoggedInUser();
            loadDashboardData();
            bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
        }

        function updateUIForLoggedInUser() {
            document.getElementById('authSection').innerHTML = `
                <span class="me-2">Welcome, ${currentUser.email}</span>
                <button class="btn btn-outline-danger btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-1"></i> Logout
                </button>
            `;
            document.getElementById('userWelcome').style.display = 'inline';
            document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.email.split('@')[0]}!`;
        }

        async function logout() {
            await supabase.auth.signOut();
            currentUser = null;
            document.getElementById('authSection').innerHTML = `
                <button class="btn btn-outline-primary" onclick="showAuthModal()">
                    <i class="fas fa-sign-in-alt me-1"></i> Login
                </button>
            `;
            document.getElementById('userWelcome').style.display = 'none';
            showAuthModal();
        }

        function showAuthModal() {
            new bootstrap.Modal(document.getElementById('authModal')).show();
        }

        // Content Generation with Real OpenAI API
        async function generateAIContent() {
            if (!currentUser) {
                showToast('Please login first', 'error');
                showAuthModal();
                return;
            }

            const prompt = document.getElementById('aiPrompt').value;
            const tone = document.getElementById('aiTone').value;
            const style = document.getElementById('contentStyle').value;

            if (!prompt.trim()) {
                showToast('Please enter a topic or description for your content', 'error');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<span class="ai-loading me-2"></span> Generating with AI...';
            generateBtn.disabled = true;

            try {
                // Call Supabase Edge Function for AI generation
                const { data, error } = await supabase.functions.invoke('socialai-groqai', {
                    body: {
                        prompt: prompt,
                        platform: selectedPlatform,
                        tone: tone,
                        style: style,
                        userId: currentUser.id
                    }
                });

                if (error) throw error;

                // Display generated content
                document.getElementById('contentPlaceholder').style.display = 'none';
                document.getElementById('generatedContent').style.display = 'block';
                document.getElementById('contentText').textContent = data.content;
                document.getElementById('contentPlatform').textContent = selectedPlatform.toUpperCase();

                // Generate and display hashtags
                await generateHashtags(prompt, selectedPlatform);

                showToast('AI content generated successfully!', 'success');
                
                // Refresh dashboard data
                loadDashboardData();

            } catch (error) {
                console.error('AI Generation error:', error);
                showToast('Failed to generate content. Please try again.', 'error');
            } finally {
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }

        async function generateHashtags(prompt, platform) {
            try {
                const { data, error } = await supabase.functions.invoke('generate-hashtags', {
                    body: {
                        prompt: prompt,
                        platform: platform,
                        userId: currentUser.id
                    }
                });

                if (error) throw error;

                document.getElementById('hashtagPlaceholder').style.display = 'none';
                document.getElementById('hashtagSection').style.display = 'block';
                
                const container = document.getElementById('hashtagContainer');
                container.innerHTML = '';
                
                data.hashtags.forEach(hashtag => {
                    const pill = document.createElement('span');
                    pill.className = 'hashtag-pill';
                    pill.textContent = hashtag.tag;
                    pill.onclick = () => copyToClipboardText(hashtag.tag);
                    container.appendChild(pill);
                });

                document.getElementById('estimatedReach').textContent = data.estimatedReach;
                document.getElementById('engagementScore').textContent = data.engagementScore + '%';

            } catch (error) {
                console.error('Hashtag generation error:', error);
                // Fallback to mock hashtags
                displayMockHashtags(prompt, platform);
            }
        }

        function displayMockHashtags(prompt, platform) {
            const mockHashtags = {
                twitter: ['#Twitter', '#Trending', '#Viral', '#Tech', '#Digital'],
                instagram: ['#Instagram', '#InstaGood', '#PhotoOfTheDay', '#Visuals', '#Creative'],
                facebook: ['#Facebook', '#Community', '#Update', '#News', '#Share'],
                linkedin: ['#LinkedIn', '#Professional', '#Career', '#Business', '#Networking'],
                tiktok: ['#TikTok', '#Viral', '#FYP', '#Trend', '#ContentCreator']
            };

            const promptWords = prompt.toLowerCase().split(' ').slice(0, 3);
            const baseHashtags = promptWords.map(word => `#${word.charAt(0).toUpperCase() + word.slice(1)}`);
            const platformTags = mockHashtags[platform] || [];
            const allHashtags = [...baseHashtags, ...platformTags];

            document.getElementById('hashtagPlaceholder').style.display = 'none';
            document.getElementById('hashtagSection').style.display = 'block';
            
            const container = document.getElementById('hashtagContainer');
            container.innerHTML = '';
            
            allHashtags.forEach(tag => {
                const pill = document.createElement('span');
                pill.className = 'hashtag-pill';
                pill.textContent = tag;
                pill.onclick = () => copyToClipboardText(tag);
                container.appendChild(pill);
            });

            document.getElementById('estimatedReach').textContent = '1.2M+';
            document.getElementById('engagementScore').textContent = '78%';
        }

        // Dashboard Data Loading
        async function loadDashboardData() {
            if (!currentUser) return;

            try {
                // Load analytics data
                const { data: analytics, error } = await supabase
                    .from('analytics')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('date', { ascending: true })
                    .limit(7);

                if (!error && analytics) {
                    updateAnalyticsChart(analytics);
                }

                // Load recent generations
                await loadRecentGenerations();
                
                // Load trending topics
                await loadTrendingTopics();
                
                // Load AI suggestions
                await loadAISuggestions();
                
                // Update stats
                await updateStats();

            } catch (error) {
                console.error('Dashboard data loading error:', error);
            }
        }

        async function loadRecentGenerations() {
            const { data, error } = await supabase
                .from('ai_generations')
                .select('*')
                .eq('user_id', currentUser.id)
                .order('created_at', { ascending: false })
                .limit(5);

            const container = document.getElementById('recentGenerations');
            if (error || !data || data.length === 0) {
                container.innerHTML = '<p class="text-muted">No generations yet. Start creating content!</p>';
                return;
            }

            container.innerHTML = data.map(gen => `
                <div class="performance-metric">
                    <div class="d-flex justify-content-between">
                        <span class="small">${gen.platform}</span>
                        <span class="badge bg-secondary">${gen.tone}</span>
                    </div>
                    <small class="text-muted">${gen.generated_content.substring(0, 80)}...</small>
                </div>
            `).join('');
        }

        async function loadTrendingTopics() {
            // This would typically come from your Supabase Edge Function
            const trendingTopics = [
                { topic: 'AI in Digital Marketing', posts: '1.2M', status: 'Trending' },
                { topic: 'Sustainable Living Tips', posts: '890K', status: 'Rising' },
                { topic: 'Remote Work Productivity', posts: '650K', status: 'Popular' },
                { topic: 'Web3 and Blockchain', posts: '540K', status: 'Emerging' }
            ];

            const container = document.getElementById('trendingTopics');
            container.innerHTML = trendingTopics.map(topic => `
                <div class="trending-topic" onclick="useTrendingTopic('${topic.topic}')">
                    <strong>${topic.topic}</strong>
                    <small>${topic.posts} posts â€¢ ${topic.status}</small>
                </div>
            `).join('');
        }

        async function loadAISuggestions() {
            const suggestions = [
                "Try creating content about AI ethics and responsibility for better engagement",
                "Consider using more video content - it performs 3x better on most platforms",
                "Post between 1-3 PM weekdays for maximum visibility and engagement"
            ];

            const container = document.getElementById('aiSuggestions');
            container.innerHTML = suggestions.map(suggestion => `
                <div class="performance-metric">
                    <i class="fas fa-lightbulb text-warning me-2"></i>
                    <small>${suggestion}</small>
                </div>
            `).join('');
        }

        async function updateStats() {
            const { data, error } = await supabase
                .from('ai_generations')
                .select('id', { count: 'exact' })
                .eq('user_id', currentUser.id);

            if (!error) {
                document.getElementById('totalGenerations').textContent = data.length;
                document.getElementById('savedTime').textContent = Math.floor(data.length * 0.5); // 30 mins saved per generation
            }
        }

        function updateAnalyticsChart(analytics) {
            const labels = analytics.map(a => new Date(a.date).toLocaleDateString());
            const data = analytics.map(a => a.engagements || Math.floor(Math.random() * 100) + 50);
            
            analyticsChart.data.labels = labels;
            analyticsChart.data.datasets[0].data = data;
            analyticsChart.update();
        }

        // Utility Functions
        function selectPlatform(element, platform) {
            document.querySelectorAll('.platform-selector').forEach(el => {
                el.classList.remove('active');
            });
            element.classList.add('active');
            selectedPlatform = platform;
        }

        function showSection(sectionName) {
            if (!currentUser) {
                showToast('Please login first', 'error');
                showAuthModal();
                return;
            }

            document.getElementById('dashboardSection').style.display = sectionName === 'dashboard' ? 'block' : 'none';
            document.getElementById('generatorSection').style.display = sectionName === 'generator' ? 'block' : 'none';
            
            if (sectionName === 'dashboard') {
                loadDashboardData();
            }
        }

        function useTrendingTopic(topic) {
            document.getElementById('aiPrompt').value = topic;
            showSection('generator');
        }

        async function loadHashtagIdeas() {
            const prompt = document.getElementById('aiPrompt').value || 'social media marketing';
            await generateHashtags(prompt, selectedPlatform);
            showSection('generator');
        }

        async function loadAnalytics() {
            await loadDashboardData();
            showToast('Analytics updated!', 'success');
        }

        // Clipboard Functions
        async function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            await copyToClipboardText(text);
        }

        async function copyToClipboardText(text) {
            try {
                await navigator.clipboard.writeText(text);
                showToast('Copied to clipboard!', 'success');
            } catch (err) {
                console.error('Failed to copy: ', err);
                showToast('Failed to copy to clipboard', 'error');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast show align-items-center text-bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0`;
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}-circle me-2"></i>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            document.querySelector('.toast-container').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // Initialize with demo content
        document.getElementById('aiPrompt').value = 'AI-powered social media content creation';
        
        
        // At the end of your module script
window.showSection = showSection;
window.showAuthModal = showAuthModal;
window.login = login;
window.generateAIContent = generateAIContent;
window.selectPlatform = selectPlatform;
window.loadHashtagIdeas = loadHashtagIdeas;
window.loadAnalytics = loadAnalytics;
// Add all other functions that are called from HTML
    </script>
</body>
</html>
